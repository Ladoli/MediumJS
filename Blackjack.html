<html>
<head>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <script>
		var cardsInDeck = new Array(); //Array of cards not draw/in the deck
		var P1 = 0; //Score or total value of the cards Player 1 has
		var P2 = 0; //Score or total value of the cards Player 2 has
		var P1Name = "Player 1"; //Name of Player 1, can be changed by user
		var P2Name = "Player 2"; //Name of Player 2, can be changed by user
		var winner ="";
		var loser ="";
    	var turn = 1; //Variable to keep track of turns
		var endedTurn = "false"; //Checks if the last turn done was "End of turn"
		var cardDrew; //Variable containing the "value" of the card drawn. This value is from 1-52 symbolizing the cards in a deck.
		var suite; //Contains the suite of a draw card such as Hearts or Diamonds
		var p1RevealedAces = 0; //Player 1 Aces with the value of 11
		var p2RevealedAces = 0; //Player 2 Aces with the value of 11
		var p1HiddenAces = 0; //Player 2 Aces with the value of 1
		var p2HiddenAces = 0; //Player 2 Aces with the value of 1
		function deckShuffle(){ //Function called to restore deck to its unused state as well as other relevant variables to their initial state
		cardsInDeck.splice(0,cardsInDeck.length); //Deletes contents of the array
		for(index = 0; index < 52; index++) //Loop fills array with the Integers 1-52 representing cards
			{
			cardsInDeck.push(index+1); //Because we won't have a card 0... Could actually add it and other "special" cards if we want to make something better than Blackjack
			}
		P1 = 0; //Shuffle function also returns everything to the start, Player1 and Player2 scores as well as turns, aces and the endedTurn checker are included in this for that reason.
		P2 = 0;
		turn = 1;
		p1RevealedAces = 0;
		p2RevealedAces = 0;
		p1HiddenAces = 0;
		p2HiddenAces = 0;
        endedTurn = "false";
		$("#pturn").html(turn); //This and the following .html code is just to update the values the user sees
		$("#p1").html(P1);
		$("#p2").html(P2);
		$("#result").html(null);
		alert("Shuffling the deck!"); //Tells users deck is shuffling...
		deal(); //Gives users two starting cards each...
		}
		function Ace(score1){ //I hate this function! But
		
			var score = Number(score1);
			if(turn == 2)
			{
				while(score > 21 && p1RevealedAces > 0)
				{
					score-=10;
					p1RevealedAces--;
					p1HiddenAces++;
				}
				
				while(score<=10 && p1HiddenAces > 0)
				{
					score+= 10;
					p1RevealedAces++;
					p1HiddenAces--;
				}
			}
			else 
			{
				while(score>21 && p2RevealedAces > 0)
				{
					score-=10;
					p2RevealedAces--;
					p2HiddenAces++;
				}
				
				while(score<=10 && p2HiddenAces > 0)
				{
					score+=10;
					p2RevealedAces++;
					p2HiddenAces--;
				}
			} 
			return score;
		}
		
		function over(score){
			if(score > 21)
			{	
				if(turn==1)
				{
					winner = P1Name;
					loser = P2Name;
				}
				else
				{
					winner = P2Name;
					loser = P1Name;
				}
				alert(loser + " drew a card with a Suite of " + suite + " with a value of " + cardValue + ". " + loser + " has a total value of " + score + " which has hit over 21! " + winner + " has won!");
				deckShuffle();
			}
			
			else if(score == 21)
			{	
				if(turn==2)
				{
					winner = P1Name;
				}
				else
				{
					winner = P2Name;
				}
				alert(winner + " drew a card with a Suite of " + suite + " with a value of " + cardValue + ". " + winner + " has a total value of " + score + "! " + winner + " has won!");
				deckShuffle();
			}
		}
		
		function deal(){
		$("button#Draw").click();
		$("button#Draw").click();
		$("button#Draw").click();
		$("button#Draw").click();
		}
		
		function valueCompare(){
		if(P1>P2){
			alert("Player 1 has a greater value with a score of " + P1 + ". Player 1 wins!");
			}
		else if(P2>P1){
			alert("Player 2 has a greater value with a score of " + P2 + ". Player 2 wins!");
			}
		else{
			alert("It is a tie!");
			}
			deckShuffle();
		}
		
		function draw(){
		var cardDrew = Math.floor(Math.random()*cardsInDeck.length);
		var drawn = cardsInDeck[cardDrew];
		cardsInDeck.splice(cardDrew, 1);
		endedTurn = "false";
		return drawn;
			}		
		function convertCard(cardToConvert) { //Do not call this function more as it messes up the "Ace" system if called elsewhere.
		cardToConvert = cardToConvert%13;
		if(cardToConvert > 10 || cardToConvert === 0)
			{
				cardToConvert = 10;
			}
		else if(turn == 1){
			if(cardToConvert == 1)
			{
			p1RevealedAces++;
			cardToConvert = 11;
			}
		}
		else{
			if(cardToConvert == 1)
			{
			p2RevealedAces++;
			cardToConvert = 11;
			}}
		return cardToConvert;
			}
		function getSuite(cardToConvert) {
		var suiteTier = (cardToConvert/13);
		var suite ="";
		if(suiteTier <= 1){
		suite = "Diamonds";
		} 
		else if(suiteTier <= 2){
		suite = "Hearts";
		}
		else if(suiteTier <= 3){
		suite = "Clubs";
		}
		else if(suiteTier <= 4){
		suite = "Spades";
		}
	
		return suite;
			}
			
		
		$("document").ready(function() {
		deckShuffle();
		$("#pturn").html(turn);
		$("#p1").html(P1);
		$("#p2").html(P2);
		$("button#dealMe").click(function(){
		deal();
		$("button#dealMe").hide();
		});
		$("button#changeName").click(function(){
			P1Name = $("input#inputP1").val();
			P2Name = $("input#inputP2").val();
			$("label#p1name").html(P1Name);
			$("label#p2name").html(P2Name);
			$("div#changey").hide();
		});
		$("button#Draw").click(function(){
			if(cardsInDeck.length === 0) //Probably not needed, but will be useful incase game goes on until deck is empty for future variants.
			{
				alert("Deck is empty! Reshuffling deck."); 
				deckShuffle();
				$("#result").html("Deck reshuffled~");
			}
			
			else{
			cardDrew = draw();
			cardValue = convertCard(cardDrew);
			suite = getSuite(cardDrew);
			var playerMoving;
			if(turn ==1)
			{
				playerMoving = P1Name;
			}
			else
			{
				playerMoving = P2Name;
			}
			$("#result").html(playerMoving + " drew a card " + cardDrew + " with a Suite of " + suite + " and a value of " + cardValue + ". There are now " + cardsInDeck.length + " cards left in deck now. " + "<!-- This code is for testing purposes only <br>The remaining values in the deck are: " +cardsInDeck.toString() + "-->");
			if(turn == 1)
			{
				turn++;
				P1 += cardValue;
				P1 = Ace(P1);
				$("#p1").html(P1);
				over(P1);
			}
			else
			{
				turn--;
				P2 += cardValue;
				P2 = Ace(P2);
				$("#p2").html(P2);
				over(P2);
			}
			}
			$("#pturn").html(turn);
			$("#noAces1").html(p1RevealedAces);
			$("#noAces2").html(p2RevealedAces);
			});
		$("button#endofTurn").click(function(){
			if(turn == 1)
			{
			turn++;
			}
			else 
			{
			turn--;
			}
			$("#pturn").html(turn);	
			
			if(endedTurn == "false")
			{
				endedTurn = "true";
			}
			else
			{
				valueCompare();
			}
			});
		});
		
		
    </script>
</head>
<body>
	<div id ="changey">
	Player 1 Name: <input type="text" id = "inputP1" value="Player 1"></input><br><br>
	Player 2 Name: <input type="text"id = "inputP2" value="Player 2"></input><br><br>
	<button id="changeName">Change Names</button>
	
	<br><br>
	</div>
	Turn: Player <label id ="pturn"></label>
	<br>
	<label id ="p1name">Player 1 </label> Total: <label id ="p1"></label>
	<br>
	<label id ="p2name">Player 2 </label> Total: <label id ="p2"></label>
	
	<br><br><br>
    <button id="Draw">Draw a Card</button>
	<button id="endofTurn">End of Turn</button>
	<button id="dealMe">Deal Me</button>
	<div id = "result"></div>
	 <!-- The following code is for testing purposes only. <br><br><br><label id ="noAces1"> </label> 
<br><label id ="noAces2"> </label> -->
</body>
</html>
